<html>
<head><link rel=stylesheet href="../jdoc.css" type="text/css">
<title>m&amp;i. Improved</title>
<link href="../jdoc.css" rel=stylesheet>
</head>

<body><!--top jump start--><a href="idotmaxmin.htm">&gt;&gt;</a>&nbsp;
<a href="idotfit0.htm">&lt;&lt;</a>&nbsp;
<a href="../user/contents.htm">Usr</a>&nbsp;
<a href="../primer/contents.htm">Pri</a>&nbsp;
<a href="../jforc/contents.htm">JfC</a>&nbsp;
<a href="../learning/contents.htm">LJ</a>&nbsp;
<a href="../phrases/contents.htm">Phr</a>&nbsp;
<a href="../dictionary/contents.htm">Dic</a>&nbsp;
<a href="../release/contents.htm">Rel</a>&nbsp;
<a href="../dictionary/vocabul.htm">Voc</a>&nbsp;
<a href="../dictionary/xmain.htm">!:</a>&nbsp;
<a href="../index.htm">Help</a>&nbsp;
Release<hr><!--top jump end-->

<br>
<table width=100%><tr><td align=left valign=top>
<b><font size=+3 face="Courier New">m&i. </font>
<font size=+3>Improved</font>
</td><td align=right>
initial writing: 2004-04-16<br>last updated: 2005-02-10
</td></tr></table>
<br>

<p>Certain verbs in the &ldquo;index of&rdquo; family with a fixed noun argument<tt> m </tt>
are now supported by special code.  That is,

<pre>
   m&amp;i.          m&amp;(i.!.0)
   m&amp;i:          m&amp;(i:!.0)
   -.&amp;m          -.!.0&amp;m
   e.&amp;m          e.!.0&amp;m
   (e.i.0:)&amp;m    + /@e.&amp;m
   (e.i.1:)&amp;m    +./@e.&amp;m
   (e.i:0:)&amp;m    *./@e.&amp;m
   (e.i:1:)&amp;m     I.@e.&amp;m
</pre>
 
<p>are now supported by special code, so that for most<tt> m </tt>and<tt> y </tt>
the phrase<tt> m&amp;i. y </tt>takes time proportional to the size of<tt> y</tt> .
(&ldquo;Most&rdquo; means amenable to hashing or some other fast pre-processing technique.)  
There is no change in performance with just one application; 
there can be a substantial improvement in performance with repeated applications.
The following benchmarks demonstrate the improvement:</p>

<pre>
x9=: 1e6 ?@$ 2e9
y9=: 1e5 ?@$ 2e9
x6=: 1e6 ?@$ 2e6
y6=: 1e5 ?@$ 2e6
c =: a {~ 1e6 4 ?@$ #a=: ' 0123456789',(97+i.26){a. 
d =: a {~ 1e5 4 ?@$ #a

f9=: x9&i.
f6=: x6&i.
fc=: c&i.
g9=: +/@e.&x9
g6=: +/@e.&x6

ts=: 6!:2 , 7!:2@]  NB. time and space
ts 'Expression'
</pre>

<table>
<tr><td align=center><b>Expression</b></td><td>&nbsp;&nbsp;&nbsp;</td>
<td align=center colspan=3><b>J 5.04</b></td><td>&nbsp;</td>
<td align=center colspan=3><b>J 5.03</b></td><td>&nbsp;</td>
<td align=center colspan=3><b>Ratio</b></td></tr>
<tr><td><tt>x9&i. y9 </tt></td><td>&nbsp;</td><td>0.1481414</td><td>&nbsp;</td><td align=right> 8913856</td><td>&nbsp;</td><td>0.1503398</td><td>&nbsp;</td><td align=right> 8913728</td><td>&nbsp;</td><td align=right>  1.01</td><td>&nbsp;</td><td align=right>   1.00</td></tr>
<tr><td><tt>f9=:x9&i.</tt></td><td>&nbsp;</td><td>0.1315829</td><td>&nbsp;</td><td align=right> 8389568</td><td>&nbsp;</td><td>0.0000033</td><td>&nbsp;</td><td align=right>     832</td><td>&nbsp;</td><td align=right>  0.00</td><td>&nbsp;</td><td align=right>   0.00</td></tr>
<tr><td><tt>f9 y9    </tt></td><td>&nbsp;</td><td>0.0166099</td><td>&nbsp;</td><td align=right>  525120</td><td>&nbsp;</td><td>0.1503235</td><td>&nbsp;</td><td align=right> 8913728</td><td>&nbsp;</td><td align=right>  9.05</td><td>&nbsp;</td><td align=right>  16.97</td></tr>
<tr><td><tt>f6 y6    </tt></td><td>&nbsp;</td><td>0.0033488</td><td>&nbsp;</td><td align=right>  525120</td><td>&nbsp;</td><td>0.0685174</td><td>&nbsp;</td><td align=right> 8913728</td><td>&nbsp;</td><td align=right> 20.46</td><td>&nbsp;</td><td align=right>  16.97</td></tr>
<tr><td><tt>fc d     </tt></td><td>&nbsp;</td><td>0.0155472</td><td>&nbsp;</td><td align=right>  525120</td><td>&nbsp;</td><td>0.1523457</td><td>&nbsp;</td><td align=right> 8913728</td><td>&nbsp;</td><td align=right>  9.80</td><td>&nbsp;</td><td align=right>  16.97</td></tr>
<tr><td><tt>g9 y9    </tt></td><td>&nbsp;</td><td>0.0160221</td><td>&nbsp;</td><td align=right>     896</td><td>&nbsp;</td><td>0.1505100</td><td>&nbsp;</td><td align=right> 8520512</td><td>&nbsp;</td><td align=right>  9.39</td><td>&nbsp;</td><td align=right>9509.50</td></tr>
<tr><td><tt>g6 y6    </tt></td><td>&nbsp;</td><td>0.0025613</td><td>&nbsp;</td><td align=right>     896</td><td>&nbsp;</td><td>0.1506287</td><td>&nbsp;</td><td align=right> 8520512</td><td>&nbsp;</td><td align=right> 58.81</td><td>&nbsp;</td><td align=right>9509.50</td></tr>
</table>

<br>
<!--bottom jump start--><hr><a href="idotmaxmin.htm">&gt;&gt;</a>&nbsp;
<a href="idotfit0.htm">&lt;&lt;</a>&nbsp;
<a href="../user/contents.htm">Usr</a>&nbsp;
<a href="../primer/contents.htm">Pri</a>&nbsp;
<a href="../jforc/contents.htm">JfC</a>&nbsp;
<a href="../learning/contents.htm">LJ</a>&nbsp;
<a href="../phrases/contents.htm">Phr</a>&nbsp;
<a href="../dictionary/contents.htm">Dic</a>&nbsp;
<a href="../release/contents.htm">Rel</a>&nbsp;
<a href="../dictionary/vocabul.htm">Voc</a>&nbsp;
<a href="../dictionary/xmain.htm">!:</a>&nbsp;
<a href="../index.htm">Help</a>&nbsp;
Release<!--bottom jump end--></body>
</html>
